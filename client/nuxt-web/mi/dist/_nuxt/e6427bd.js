(window.webpackJsonp=window.webpackJsonp||[]).push([[23,5,6],{501:function(e,t,n){var content=n(509);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(10).default)("dac36112",content,!0,{sourceMap:!1})},503:function(e,t,n){"use strict";n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(27),o=n(127),l=n.n(o);function d(e){return Object(r.a)({url:"shipping",method:"GET",params:e})}function c(data){return data=l.a.parse(data),Object(r.a)({url:"shipping",method:"POST",data:data})}function m(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/"+data.id,method:"POST",data:data})}function f(e){return Object(r.a)({url:"shipping/destroy/"+e,method:"POST"})}function h(e,data){return data=l.a.parse(data),Object(r.a)({url:"shipping/freight/"+e,method:"POST",data:data})}function v(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/default/set",method:"POST",data:data})}},504:function(e,t,n){"use strict";n.r(t);var r=n(7),o=(n(49),n(16),n(32),n(17),n(62),n(503));t.default={name:"AddressList",props:{select:{type:Boolean,default:!1}},data:function(){return{restaurants:[],buttonLoading:!1,loading:!1,dialogTitle:"添加收货地址",centerDialogVisible:!1,list:[],ruleForm:{location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],cellphone:[{validator:function(e,t,n){if(""===t)n(new Error("请输入手机号"));else{/^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/.test(t)||n(new Error("手机号格式有误")),n()}},trigger:"blur"}],location:[{required:!0,message:"请输入地址",trigger:"blur"}],house:[{required:!0,message:"请输入门牌号",trigger:"blur"}]}}},watch:{},mounted:function(){this.getList()},methods:{getList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(o.f)({sort:"-defaults"}).then((function(t){e.loading=!1,e.list=t.data,e.list.forEach((function(t){t.defaults?(t.on=!0,e.$emit("selectedAddress",t)):t.on=!1}))})).catch((function(){e.loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},switchAddress:function(e){this.select&&(this.list.forEach((function(e){e.on=!1})),e.on=!0,this.$emit("selectedAddress",e),this.$forceUpdate())},submitForm:function(){var e=this;this.$refs.ruleForm.validate((function(t){t&&(e.buttonLoading=!0,e.ruleForm.id?Object(o.d)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.centerDialogVisible=!1,e.$refs.ruleForm.resetFields(),e.getList(),e.$message({message:"修改成功",type:"success"})})).catch((function(){e.buttonLoading=!1})):Object(o.a)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.centerDialogVisible=!1,e.$refs.ruleForm.resetFields(),e.getList(),e.$message({message:"添加成功",type:"success"})})).catch((function(){e.buttonLoading=!1})))}))},defaultAddress:function(e){var t=this;this.$confirm("是否设为默认？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){t.buttonLoading=!0,Object(o.b)(e).then((function(e){t.buttonLoading=!1,t.getList(),t.$message({message:"设置成功",type:"success"})})).catch((function(){t.buttonLoading=!1}))})).catch((function(){}))},deleteAddress:function(e){var t=this;e.defaults?this.$message({message:"默认地址无法删除",type:"error"}):this.$confirm("确定要删除该地址吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){t.buttonLoading=!0,Object(o.c)(e.id).then((function(e){t.buttonLoading=!1,t.getList(),t.$message({message:"删除成功",type:"success"})})).catch((function(){t.buttonLoading=!1}))})).catch((function(){}))},updateAddress:function(e){e.id?(this.ruleForm=e,this.dialogTitle="修改收货地址"):(this.ruleForm={location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},this.dialogTitle="添加收货地址"),this.centerDialogVisible=!0},querySearch:function(e,t){var n=this,r=this.restaurants;$nuxt.$axios.get("https://restapi.amap.com/v3/place/text",{params:{keywords:e,key:""}}).then((function(e){"OK"===e.data.info?((r=e.data.pois).forEach((function(e){e.value=e.name})),n.restaurants=r):console.log("没有查询结果")})).catch((function(e){console.log("response",e)})),this.$forceUpdate(),t(r)},handleSelect:function(e){var t=e.location.split(",");this.ruleForm.address=e.address,this.ruleForm.longitude=t[0],this.ruleForm.latitude=t[1]}}}},506:function(e,t,n){"use strict";n.r(t);var r=n(504).default,o=(n(508),n(6)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"address-list"},[e._l(e.list,(function(t,r){return n("div",{key:r,staticClass:"address-item"},[n("div",{staticClass:"item-on",class:{on:t.on&&e.select},on:{click:function(n){return e.switchAddress(t)}}},[n("div",{staticClass:"address-info"},[n("div",{staticClass:"name"},[e._v("\n              "+e._s(t.name)+"\n              "),t.defaults?n("span",[e._v("默认")]):e._e()]),e._v(" "),n("div",{staticClass:"cellphone"},[e._v(e._s(t.cellphone))]),e._v(" "),n("div",{staticClass:"address-con"},[e._v(e._s(t.location?t.location+"(":"")+e._s(t.address)+" "+e._s(t.house?")"+t.house:""))]),e._v(" "),n("div",{staticClass:"address-action"},[e.select?e._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.defaultAddress(t)}}},[e._v("设为默认")]),e._v(" "),n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.updateAddress(t)}}},[e._v("修改")]),e._v(" "),e.select?e._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.deleteAddress(t)}}},[e._v("删除")])],1)])])])})),e._v(" "),n("div",{staticClass:"address-item",on:{click:e.updateAddress}},[e._m(0)])],2),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.centerDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"联系人",prop:"name"}},[n("el-input",{attrs:{clearable:"",maxlength:"20",placeholder:"请输入姓名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"手机号",prop:"cellphone"}},[n("el-input",{attrs:{clearable:"",maxlength:"11",placeholder:"请输入手机号"},model:{value:e.ruleForm.cellphone,callback:function(t){e.$set(e.ruleForm,"cellphone",t)},expression:"ruleForm.cellphone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"地址",prop:"location"}},[n("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearch,placeholder:"例如：宁波 天一广场","trigger-on-focus":!1},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(r.value))]),e._v(" "),n("span",{staticClass:"addr"},[e._v(e._s(r.adname+" "+r.address))])]}}]),model:{value:e.ruleForm.location,callback:function(t){e.$set(e.ruleForm,"location",t)},expression:"ruleForm.location"}}),e._v(" "),n("div",[e._v("输入完成后如没有想要的地址，可以多输入一个空格，在弹出列表中选择所在地区")])],1),e._v(" "),n("el-form-item",{attrs:{label:"门牌号",prop:"house"}},[n("el-input",{attrs:{clearable:"",maxlength:"80",placeholder:"请输入门牌号"},model:{value:e.ruleForm.house,callback:function(t){e.$set(e.ruleForm,"house",t)},expression:"ruleForm.house"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.buttonLoading},on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{loading:e.buttonLoading,type:"danger"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"item"},[n("div",{staticClass:"add-desc"},[n("div",[n("i",{staticClass:"el-icon-circle-plus"})]),e._v(" "),n("div",[e._v("添加新地址")])])])}],!1,null,"2591aec2",null);t.default=component.exports},508:function(e,t,n){"use strict";n(501)},509:function(e,t,n){var r=n(9)(!1);r.push([e.i,".address-list[data-v-2591aec2]{display:flex;flex-wrap:wrap;align-content:center}.address-list .address-item[data-v-2591aec2]{width:25%;padding-right:10px;padding-bottom:10px}.address-list .address-item .item[data-v-2591aec2]{cursor:pointer;border:1px solid #e0e0e0;display:flex;justify-content:center;align-items:center;height:180px}.address-list .address-item .item .add-desc[data-v-2591aec2]{text-align:center;color:#b0b0b0}.address-list .address-item .item .add-desc i[data-v-2591aec2]{color:#e0e0e0;font-size:32px;margin-bottom:10px}.address-list .address-item .item:hover i[data-v-2591aec2]{color:#b0b0b0}.address-list .address-item .item-on[data-v-2591aec2]{cursor:pointer;border:1px solid #e0e0e0;display:flex;height:180px;padding:20px;position:relative}.address-list .address-item .item-on .address-info[data-v-2591aec2]{width:100%;font-size:14px;color:#757575}.address-list .address-item .item-on .address-info .name[data-v-2591aec2]{font-size:18px;margin-bottom:20px}.address-list .address-item .item-on .address-info .name span[data-v-2591aec2]{color:#fa524c;float:right;font-size:12px}.address-list .address-item .item-on .address-info .address-action[data-v-2591aec2]{position:absolute;bottom:20px;right:20px;display:none}.address-list .address-item .item-on:hover .address-action[data-v-2591aec2]{display:block}.address-list .address-item .item-on.on[data-v-2591aec2]{border:1px solid #fa524c}",""]),e.exports=r},539:function(e,t,n){"use strict";n.r(t);var r=n(7),o=(n(49),n(201),n(17),n(77),n(300),n(16),n(50),n(506)),l=n(503),d=n(128);t.default={components:{addressList:o.default},layout:"cart",middleware:"auth",head:function(){return{title:"确认订单-天明商城-跨终端免费平台"}},data:function(){return{loading:!0,buttonLoading:!0,total:0,ruleForm:{indentCommodity:[],address:{},remark:"",carriage:0},rules:{remark:[{validator:function(e,t,n){if(new RegExp("[`~!@#$^&*()=|{}':'\\[\\].<>《》/?~！@#￥……&*（）——|{}【】‘：”“'。？ ]").test(t))return n(new Error("不允许输入非法字符"));n()},trigger:"blur"}]}}},mounted:function(){$nuxt.$store.commit("setCartTitle","确认订单"),this.getList()},methods:{getList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null,e.ruleForm.indentCommodity=Object.values(e.store.get("TMSHOP-PC-OrderList")),e.ruleForm.indentCommodity.forEach((function(t){e.total+=t.price*t.number,t.good_sku&&(n=null,t.good_sku.product_sku.forEach((function(e){n?n+=e.value+";":n=e.value+";"})),t.specification=n.substr(0,n.length-1))}));case 3:case"end":return t.stop()}}),t)})))()},selectedAddress:function(e){var t=this;this.buttonLoading=!0,this.ruleForm.address=e,Object(l.e)(e.id,this.ruleForm.indentCommodity).then((function(e){t.ruleForm.carriage=e.carriage,t.buttonLoading=!1}))},submit:function(){var e=this;this.$refs.ruleForm.validate((function(t){return t?e.ruleForm.address?(e.buttonLoading=!0,void Object(d.c)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.store.remove("TMSHOP-PC-CartList"),e.store.remove("TMSHOP-PC-OrderList"),Object(d.a)([]),$nuxt.$router.replace({path:"/money/pay",query:{id:t}})})).catch((function(){e.buttonLoading=!1}))):(e.$message({message:"请选择地址",type:"error"}),!1):(console.log("error submit!!"),!1)}))},go:function(){$nuxt.$router.go(-1)}}}}}]);