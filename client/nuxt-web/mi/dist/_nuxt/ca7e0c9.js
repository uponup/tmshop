(window.webpackJsonp=window.webpackJsonp||[]).push([[22,5,6,23],{501:function(t,e,n){var content=n(509);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(10).default)("dac36112",content,!0,{sourceMap:!1})},503:function(t,e,n){"use strict";n.d(e,"f",(function(){return d})),n.d(e,"a",(function(){return c})),n.d(e,"d",(function(){return m})),n.d(e,"c",(function(){return f})),n.d(e,"e",(function(){return v})),n.d(e,"b",(function(){return h}));var r=n(27),o=n(127),l=n.n(o);function d(t){return Object(r.a)({url:"shipping",method:"GET",params:t})}function c(data){return data=l.a.parse(data),Object(r.a)({url:"shipping",method:"POST",data:data})}function m(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/"+data.id,method:"POST",data:data})}function f(t){return Object(r.a)({url:"shipping/destroy/"+t,method:"POST"})}function v(t,data){return data=l.a.parse(data),Object(r.a)({url:"shipping/freight/"+t,method:"POST",data:data})}function h(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/default/set",method:"POST",data:data})}},504:function(t,e,n){"use strict";n.r(e);var r=n(7),o=(n(49),n(16),n(32),n(17),n(62),n(503));e.default={name:"AddressList",props:{select:{type:Boolean,default:!1}},data:function(){return{restaurants:[],buttonLoading:!1,loading:!1,dialogTitle:"添加收货地址",centerDialogVisible:!1,list:[],ruleForm:{location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],cellphone:[{validator:function(t,e,n){if(""===e)n(new Error("请输入手机号"));else{/^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/.test(e)||n(new Error("手机号格式有误")),n()}},trigger:"blur"}],location:[{required:!0,message:"请输入地址",trigger:"blur"}],house:[{required:!0,message:"请输入门牌号",trigger:"blur"}]}}},watch:{},mounted:function(){this.getList()},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,Object(o.f)({sort:"-defaults"}).then((function(e){t.loading=!1,t.list=e.data,t.list.forEach((function(e){e.defaults?(e.on=!0,t.$emit("selectedAddress",e)):e.on=!1}))})).catch((function(){t.loading=!1}));case 3:case"end":return e.stop()}}),e)})))()},switchAddress:function(t){this.select&&(this.list.forEach((function(t){t.on=!1})),t.on=!0,this.$emit("selectedAddress",t),this.$forceUpdate())},submitForm:function(){var t=this;this.$refs.ruleForm.validate((function(e){e&&(t.buttonLoading=!0,t.ruleForm.id?Object(o.d)(t.ruleForm).then((function(e){t.buttonLoading=!1,t.centerDialogVisible=!1,t.$refs.ruleForm.resetFields(),t.getList(),t.$message({message:"修改成功",type:"success"})})).catch((function(){t.buttonLoading=!1})):Object(o.a)(t.ruleForm).then((function(e){t.buttonLoading=!1,t.centerDialogVisible=!1,t.$refs.ruleForm.resetFields(),t.getList(),t.$message({message:"添加成功",type:"success"})})).catch((function(){t.buttonLoading=!1})))}))},defaultAddress:function(t){var e=this;this.$confirm("是否设为默认？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.buttonLoading=!0,Object(o.b)(t).then((function(t){e.buttonLoading=!1,e.getList(),e.$message({message:"设置成功",type:"success"})})).catch((function(){e.buttonLoading=!1}))})).catch((function(){}))},deleteAddress:function(t){var e=this;t.defaults?this.$message({message:"默认地址无法删除",type:"error"}):this.$confirm("确定要删除该地址吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.buttonLoading=!0,Object(o.c)(t.id).then((function(t){e.buttonLoading=!1,e.getList(),e.$message({message:"删除成功",type:"success"})})).catch((function(){e.buttonLoading=!1}))})).catch((function(){}))},updateAddress:function(t){t.id?(this.ruleForm=t,this.dialogTitle="修改收货地址"):(this.ruleForm={location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},this.dialogTitle="添加收货地址"),this.centerDialogVisible=!0},querySearch:function(t,e){var n=this,r=this.restaurants;$nuxt.$axios.get("https://restapi.amap.com/v3/place/text",{params:{keywords:t,key:""}}).then((function(t){"OK"===t.data.info?((r=t.data.pois).forEach((function(t){t.value=t.name})),n.restaurants=r):console.log("没有查询结果")})).catch((function(t){console.log("response",t)})),this.$forceUpdate(),e(r)},handleSelect:function(t){var e=t.location.split(",");this.ruleForm.address=t.address,this.ruleForm.longitude=e[0],this.ruleForm.latitude=e[1]}}}},506:function(t,e,n){"use strict";n.r(e);var r=n(504).default,o=(n(508),n(6)),component=Object(o.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"address-list"},[t._l(t.list,(function(e,r){return n("div",{key:r,staticClass:"address-item"},[n("div",{staticClass:"item-on",class:{on:e.on&&t.select},on:{click:function(n){return t.switchAddress(e)}}},[n("div",{staticClass:"address-info"},[n("div",{staticClass:"name"},[t._v("\n              "+t._s(e.name)+"\n              "),e.defaults?n("span",[t._v("默认")]):t._e()]),t._v(" "),n("div",{staticClass:"cellphone"},[t._v(t._s(e.cellphone))]),t._v(" "),n("div",{staticClass:"address-con"},[t._v(t._s(e.location?e.location+"(":"")+t._s(e.address)+" "+t._s(e.house?")"+e.house:""))]),t._v(" "),n("div",{staticClass:"address-action"},[t.select?t._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return t.defaultAddress(e)}}},[t._v("设为默认")]),t._v(" "),n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return t.updateAddress(e)}}},[t._v("修改")]),t._v(" "),t.select?t._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return t.deleteAddress(e)}}},[t._v("删除")])],1)])])])})),t._v(" "),n("div",{staticClass:"address-item",on:{click:t.updateAddress}},[t._m(0)])],2),t._v(" "),n("el-dialog",{attrs:{title:t.dialogTitle,visible:t.centerDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[n("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"联系人",prop:"name"}},[n("el-input",{attrs:{clearable:"",maxlength:"20",placeholder:"请输入姓名"},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"手机号",prop:"cellphone"}},[n("el-input",{attrs:{clearable:"",maxlength:"11",placeholder:"请输入手机号"},model:{value:t.ruleForm.cellphone,callback:function(e){t.$set(t.ruleForm,"cellphone",e)},expression:"ruleForm.cellphone"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"地址",prop:"location"}},[n("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"popper-class":"my-autocomplete","fetch-suggestions":t.querySearch,placeholder:"例如：宁波 天一广场","trigger-on-focus":!1},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.item;return[n("div",{staticClass:"name"},[t._v(t._s(r.value))]),t._v(" "),n("span",{staticClass:"addr"},[t._v(t._s(r.adname+" "+r.address))])]}}]),model:{value:t.ruleForm.location,callback:function(e){t.$set(t.ruleForm,"location",e)},expression:"ruleForm.location"}}),t._v(" "),n("div",[t._v("输入完成后如没有想要的地址，可以多输入一个空格，在弹出列表中选择所在地区")])],1),t._v(" "),n("el-form-item",{attrs:{label:"门牌号",prop:"house"}},[n("el-input",{attrs:{clearable:"",maxlength:"80",placeholder:"请输入门牌号"},model:{value:t.ruleForm.house,callback:function(e){t.$set(t.ruleForm,"house",e)},expression:"ruleForm.house"}})],1)],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:t.buttonLoading},on:{click:function(e){t.centerDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{loading:t.buttonLoading,type:"danger"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("确 定")])],1)],1)],1)}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"item"},[n("div",{staticClass:"add-desc"},[n("div",[n("i",{staticClass:"el-icon-circle-plus"})]),t._v(" "),n("div",[t._v("添加新地址")])])])}],!1,null,"2591aec2",null);e.default=component.exports},508:function(t,e,n){"use strict";n(501)},509:function(t,e,n){var r=n(9)(!1);r.push([t.i,".address-list[data-v-2591aec2]{display:flex;flex-wrap:wrap;align-content:center}.address-list .address-item[data-v-2591aec2]{width:25%;padding-right:10px;padding-bottom:10px}.address-list .address-item .item[data-v-2591aec2]{cursor:pointer;border:1px solid #e0e0e0;display:flex;justify-content:center;align-items:center;height:180px}.address-list .address-item .item .add-desc[data-v-2591aec2]{text-align:center;color:#b0b0b0}.address-list .address-item .item .add-desc i[data-v-2591aec2]{color:#e0e0e0;font-size:32px;margin-bottom:10px}.address-list .address-item .item:hover i[data-v-2591aec2]{color:#b0b0b0}.address-list .address-item .item-on[data-v-2591aec2]{cursor:pointer;border:1px solid #e0e0e0;display:flex;height:180px;padding:20px;position:relative}.address-list .address-item .item-on .address-info[data-v-2591aec2]{width:100%;font-size:14px;color:#757575}.address-list .address-item .item-on .address-info .name[data-v-2591aec2]{font-size:18px;margin-bottom:20px}.address-list .address-item .item-on .address-info .name span[data-v-2591aec2]{color:#fa524c;float:right;font-size:12px}.address-list .address-item .item-on .address-info .address-action[data-v-2591aec2]{position:absolute;bottom:20px;right:20px;display:none}.address-list .address-item .item-on:hover .address-action[data-v-2591aec2]{display:block}.address-list .address-item .item-on.on[data-v-2591aec2]{border:1px solid #fa524c}",""]),t.exports=r},539:function(t,e,n){"use strict";n.r(e);var r=n(7),o=(n(49),n(201),n(17),n(77),n(300),n(16),n(50),n(506)),l=n(503),d=n(128);e.default={components:{addressList:o.default},layout:"cart",middleware:"auth",head:function(){return{title:"确认订单-天明商城-跨终端免费平台"}},data:function(){return{loading:!0,buttonLoading:!0,total:0,ruleForm:{indentCommodity:[],address:{},remark:"",carriage:0},rules:{remark:[{validator:function(t,e,n){if(new RegExp("[`~!@#$^&*()=|{}':'\\[\\].<>《》/?~！@#￥……&*（）——|{}【】‘：”“'。？ ]").test(e))return n(new Error("不允许输入非法字符"));n()},trigger:"blur"}]}}},mounted:function(){$nuxt.$store.commit("setCartTitle","确认订单"),this.getList()},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,t.ruleForm.indentCommodity=Object.values(t.store.get("TMSHOP-PC-OrderList")),t.ruleForm.indentCommodity.forEach((function(e){t.total+=e.price*e.number,e.good_sku&&(n=null,e.good_sku.product_sku.forEach((function(t){n?n+=t.value+";":n=t.value+";"})),e.specification=n.substr(0,n.length-1))}));case 3:case"end":return e.stop()}}),e)})))()},selectedAddress:function(t){var e=this;this.buttonLoading=!0,this.ruleForm.address=t,Object(l.e)(t.id,this.ruleForm.indentCommodity).then((function(t){e.ruleForm.carriage=t.carriage,e.buttonLoading=!1}))},submit:function(){var t=this;this.$refs.ruleForm.validate((function(e){return e?t.ruleForm.address?(t.buttonLoading=!0,void Object(d.c)(t.ruleForm).then((function(e){t.buttonLoading=!1,t.store.remove("TMSHOP-PC-CartList"),t.store.remove("TMSHOP-PC-OrderList"),Object(d.a)([]),$nuxt.$router.replace({path:"/money/pay",query:{id:e}})})).catch((function(){t.buttonLoading=!1}))):(t.$message({message:"请选择地址",type:"error"}),!1):(console.log("error submit!!"),!1)}))},go:function(){$nuxt.$router.go(-1)}}}},540:function(t,e,n){var content=n(596);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(10).default)("27f8bd05",content,!0,{sourceMap:!1})},595:function(t,e,n){"use strict";n(540)},596:function(t,e,n){var r=n(9)(!1);r.push([t.i,".remark[data-v-0f8d93ae]{margin-top:30px}.specification[data-v-0f8d93ae]{color:#999}.indent-create[data-v-0f8d93ae]{margin-top:40px;margin-bottom:40px}.indent-create .address-box .title[data-v-0f8d93ae]{color:#333;font-size:18px;margin-bottom:20px}.indent-create .address-box .address-box-list[data-v-0f8d93ae]{margin-bottom:20px}.indent-create .address-box .count-detail[data-v-0f8d93ae]{margin-top:50px;text-align:right}.indent-create .address-box .count-detail .bill-item[data-v-0f8d93ae]{display:flex;justify-content:flex-end;line-height:35px;color:#757575;font-size:14px}.indent-create .address-box .count-detail .bill-item .bill-money[data-v-0f8d93ae]{width:80px;color:#fa524c}.indent-create .address-box .count-detail .bill-item .bill-name[data-v-0f8d93ae]{display:flex}.indent-create .address-box .count-detail .bill-item .bill-name .price[data-v-0f8d93ae]{color:#fa524c;font-size:30px;position:relative;top:-5px;margin-right:5px;margin-left:5px}.indent-create .address-box .count-detail .bill-item .bill-name .unit[data-v-0f8d93ae]{color:#fa524c}.indent-create .operation[data-v-0f8d93ae]{display:flex;justify-content:flex-end}",""]),t.exports=r},668:function(t,e,n){"use strict";n.r(e);var r=n(539).default,o=(n(595),n(6)),component=Object(o.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box"},[n("el-card",{staticClass:"container indent-create",attrs:{shadow:"always"}},[n("div",{staticClass:"address-box"},[n("div",{staticClass:"title"},[t._v("收货地址")]),t._v(" "),n("address-list",{staticClass:"address-box-list",attrs:{select:!0},on:{selectedAddress:t.selectedAddress}}),t._v(" "),n("div",{staticClass:"title"},[t._v("确认订单信息")]),t._v(" "),n("el-table",{ref:"table",staticClass:"table",attrs:{data:t.ruleForm.indentCommodity}},[n("el-table-column",{attrs:{align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("NuxtLink",{attrs:{to:{path:"/product/detail",query:{id:e.row.good_id}}}},[n("el-image",{staticClass:"image",attrs:{src:t._f("smallImage")(e.row.img,80),fit:"cover"}})],1)]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("NuxtLink",{attrs:{to:{path:"/product/detail",query:{id:e.row.good_id}}}},[n("p",[t._v(t._s(e.row.name))]),t._v(" "),n("p",{staticClass:"specification"},[t._v(t._s(e.row.specification))])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"单价",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("thousands")(e.row.price))+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"数量",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.good_sku.inventory)+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"小计",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("thousands")(e.row.price*e.row.number))+"\n          ")]}}])})],1),t._v(" "),n("el-form",{ref:"ruleForm",staticClass:"remark",attrs:{model:t.ruleForm,rules:t.rules}},[n("el-form-item",{attrs:{prop:"remark"}},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},model:{value:t.ruleForm.remark,callback:function(e){t.$set(t.ruleForm,"remark",e)},expression:"ruleForm.remark"}})],1)],1),t._v(" "),n("div",{staticClass:"count-detail"},[n("div",{staticClass:"bill-item"},[n("div",{staticClass:"bill-name"},[t._v("商品件数：")]),t._v(" "),n("div",{staticClass:"bill-money"},[t._v(t._s(t.ruleForm.indentCommodity.length)+"件")])]),t._v(" "),n("div",{staticClass:"bill-item"},[n("div",{staticClass:"bill-name"},[t._v("商品总价：")]),t._v(" "),n("div",{staticClass:"bill-money"},[t._v(t._s(t._f("thousands")(t.total))+"元")])]),t._v(" "),n("div",{staticClass:"bill-item"},[n("div",{staticClass:"bill-name"},[t._v("运费：")]),t._v(" "),n("div",{staticClass:"bill-money"},[t._v(t._s(t._f("thousands")(t.ruleForm.carriage))+"元")])]),t._v(" "),n("div",{staticClass:"bill-item",staticStyle:{"margin-top":"10px"}},[n("div",{staticClass:"bill-name"},[n("div",{staticClass:"name"},[t._v("应付总额：")]),t._v(" "),n("div",{staticClass:"price"},[t._v(t._s(t._f("thousands")(t.ruleForm.carriage+t.total)))]),t._v(" "),n("div",{staticClass:"unit"},[t._v("元")])])])]),t._v(" "),n("el-divider"),t._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{plain:"",loading:t.buttonLoading},on:{click:t.go}},[t._v("返回购物车")]),t._v(" "),n("el-button",{attrs:{type:"danger",loading:t.buttonLoading},on:{click:t.submit}},[t._v("去结算")])],1)],1)])],1)}),[],!1,null,"0f8d93ae",null);e.default=component.exports;installComponents(component,{AddressList:n(506).default})}}]);