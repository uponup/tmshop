(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{532:function(t,e,r){"use strict";r.r(e),r.d(e,"creatIds",(function(){return l})),r.d(e,"getLevels",(function(){return f})),r.d(e,"flatten",(function(){return m})),r.d(e,"isEqual",(function(){return k})),r.d(e,"combInArray",(function(){return v})),r.d(e,"getCombFlags",(function(){return _}));r(44),r(37),r(43),r(74),r(75);var n=r(34),o=r(531),c=(r(95),r(16),r(198),r(63),r(51),["skus"]);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var l=function(t){return t.reduce((function(e,r,n){return"".concat(e).concat(r.k_id,"-").concat(r.v_id).concat(n===t.length-1?"":"_")}),"")};function f(t){for(var e=[],i=t.length-1;i>=0;i--)t[i+1]&&t[i+1].leaf?e[i]=t[i+1].leaf.length*e[i+1]||1:e[i]=1;return e}function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=r||{},d=n.optionValue,l=void 0===d?"id":d,m=n.optionText,k=void 0===m?"value":m,v=[],_=0,S={},y=f(t);if(0===t.length)return v;t.forEach((function(t){var e=t.leaf;if(!e||0===e.length)return!0;_=(_||1)*e.length})),e.forEach((function(t){var e=t.skus,r=Object(o.a)(t,c);S[e.map((function(t){return"".concat(t.k_id,"_").concat(t.v_id)})).join("|")]=r}));for(var O=function(i){var e=[],r=[];t.forEach((function(n,o){var c=n.leaf,d={};if(!c||0===c.length)return!0;if(c.length>1){var h=parseInt(i/y[o],10)%c.length;d=t[o].leaf[h]}else d=t[o].leaf[0];n[l]&&d[l]&&(r.push("".concat(n[l],"_").concat(d[l])),e.push({k_id:n[l],k:n[k],v_id:d[l],v:d[k]}))}));var n=S[r.join("|")]||{},data=Object.assign({},n);v.push(h(h({},data),{},{skus:e}))},i=0;i<_;i++)O(i);return v}function k(t,e,r){var n=(r||{}).optionValue,o=void 0===n?"id":n;return e.length===t.length&&e.every((function(r,n){var c=r.leaf,d=void 0===c?[]:c,h=t[n].leaf||[];return t[n][o]===e[n][o]&&d.length===h.length&&d.map((function(t){return t[o]})).join(",")===h.map((function(t){return t[o]})).join(",")}))}function v(t){if(!t||!t.length)return[];for(var e=t.length,r=[],n=[],o=1;o<e;o++)for(var c=_(e,o);c.length;){for(var d=c.shift(),h=[],i=0;i<e;i++)d[i]&&h.push(t[i].v_id);r.push(h)}for(o=0;o<e;o++)n.push(t[o].v_id);return r.push(n),r}function _(t,e){if(!e||e<1)return[];var i,r,n,o=[],c=[],d=!0;for(i=0;i<t;i++)c[i]=i<e?1:0;for(o.push(c.concat());d;)for(n=0,i=0;i<t-1;i++){if(1==c[i]&&0==c[i+1]){for(r=0;r<i;r++)c[r]=r<n?1:0;c[i]=0,c[i+1]=1;var h=c.concat();o.push(h),-1==h.slice(-e).join("").indexOf("0")&&(d=!1);break}1==c[i]&&n++}return o}},533:function(t,e,r){"use strict";r.r(e);var n=r(665),o=(r(16),r(510),r(17),r(50),r(198),r(200),r(32),r(609),r(11),r(28),r(613),r(615),r(616),r(617),r(618),r(619),r(621),r(622),r(623),r(624),r(625),r(626),r(627),r(31),r(586)),c=r(128),d=r(98);e.default={name:"sku",props:{getList:{type:Object,default:function(){return{}}},cartDetails:{type:Object,default:function(){return{}}},update:{type:Boolean,default:!1},order:{type:Boolean,default:!1}},data:function(){return{cartGood:{number:1,price:""},specSelected:[],SKUResult:{},good_sku:{},selectedSku:[],selectedSkuIndex:[[]],specSelectedIndex:[],productSkus:[],selectedName:[],noSelectedName:[],specificationDefaultDisplay:{},specification:[],shoppingAttributes:[],getLists:this.getList}},watch:{getList:function(t){this.$emit("getList",t),this.getLists=this.getList,this.update||this.loadData()},getLists:function(t){this.$emit("getLists",t)},cartDetails:function(t){this.getLists=t.good,this.initSelectSpec(t)}},mounted:function(){this.loadData()},methods:{loadData:function(){var t=this;if(this.selectedSku=[],this.getLists.good_sku.length>0){var e=Object(o.param2Data)(this.getLists.good_sku),r=e.productSkus,n=e.specification;this.specification=n,n.forEach((function(e,r){t.specSelectedIndex.push(null),t.noSelectedName.push(e.value),e.leaf.forEach((function(e,n){t.selectedSku.push(e.id),t.selectedSkuIndex[e.id]={index:r,leaf:n}}))})),this.productSkus=r,r.forEach((function(e,r){e.data.forEach((function(e){e.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),t.SKUResult[e.join("_")]=!0}))})),this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show,selected:"选择 "+this.noSelectedName},this.$emit("purchasePattern",this.specificationDefaultDisplay)}else this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show},this.cartGood.price=this.getLists.price;if(void 0!==this.specification[0].leaf[0])for(var i=0;i<this.specification.length;i++)this.selectSpec(i,0,this.specification[i].leaf[0])},initSelectSpec:function(t){var e=this;this.selectedSku=[],this.SKUResult=[],this.cartGood.price=t.price,this.cartGood.number=t.number,this.shoppingAttributes=t.good_sku,this.good_sku=t.good_sku;var r=[],n=[];if(t.good_sku){var c=Object(o.param2Data)(this.getLists.good_sku),d=c.productSkus,h=c.specification;this.specification=h,h.forEach((function(o,c){o.leaf.forEach((function(d,l){for(var i=0;i<t.good_sku.product_sku.length;i++)if(d.value===t.good_sku.product_sku[i].value){o.leaf[l].selected=!0,e.specSelectedIndex[c]=l,null!==l&&(r.push(h[c].leaf[l].id),n.push(c));break}e.selectedSku.push(d.id),e.selectedSkuIndex[d.id]={index:c,leaf:l}}))})),this.productSkus=d,d.forEach((function(t,r){t.data.forEach((function(t){t.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),e.SKUResult[t.join("_")]=!0}))}))}this.specificationDefaultDisplay={img:t.img,price_show:[t.good_sku.price],inventory_show:t.good_sku.inventory,selected:"已选 "+t.specification};var l=JSON.parse(JSON.stringify(this.selectedSku)),f=[];l.forEach((function(t){(f=JSON.parse(JSON.stringify(r))).push(t),n.forEach((function(n,o){e.specification[n].leaf.forEach((function(e){e.id===t&&f.splice(f.indexOf(r[o]),1)}))})),f.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),e.SKUResult[f.join("_")]?e.specification[e.selectedSkuIndex[t].index].leaf[e.selectedSkuIndex[t].leaf].disabled=!1:e.specification[e.selectedSkuIndex[t].index].leaf[e.selectedSkuIndex[t].leaf].disabled=!0}))},priceInput:function(t){this.cartGood.price=parseFloat(t.target.value)},selectSpec:function(t,e,r){var n=this;if(r.disabled)return!1;var o=!1,c=this.specification;this.specSelectedIndex[t]===e?(this.$set(c[t].leaf[e],"selected",!c[t].leaf[e].selected),this.specSelectedIndex[t]=null,this.noSelectedName.splice(t,0,c[t].value)):(null!==this.specSelectedIndex[t]&&this.$set(c[t].leaf[this.specSelectedIndex[t]],"selected",!1),this.$set(c[t].leaf[e],"selected",!c[t].leaf[e].selected),this.specSelectedIndex[t]=e,this.noSelectedName.forEach((function(e,r){e===c[t].value&&n.noSelectedName.splice(r,1)}))),this.noSelectedName.length>0&&(this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show,selected:"选择 "+this.noSelectedName},this.update||this.$emit("purchasePattern",this.specificationDefaultDisplay)),this.specSelected=[];var d="",h=[],l=[],f=JSON.parse(JSON.stringify(this.selectedSku));this.specSelectedIndex.forEach((function(t,e){null!==t?(n.specSelected.push(c[e].leaf[t]),d+=c[e].id+"-"+c[e].leaf[t].id+"_",h.push(c[e].leaf[t].id),f.splice(f.indexOf(c[e].leaf[t].id),1),l.push(e),o=!0):o=!1}));var m=[];if(f.forEach((function(t){(m=JSON.parse(JSON.stringify(h))).push(t),l.forEach((function(e,r){n.specification[e].leaf.forEach((function(e){e.id===t&&m.splice(m.indexOf(h[r]),1)}))})),m.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),n.SKUResult[m.join("_")]?c[n.selectedSkuIndex[t].index].leaf[n.selectedSkuIndex[t].leaf].disabled=!1:c[n.selectedSkuIndex[t].index].leaf[n.selectedSkuIndex[t].leaf].disabled=!0})),!0===o){this.cartGood.number=1,this.shoppingAttributes=[];for(var i=0;i<this.productSkus.length;i++){if(this.productSkus[i].ids===d.substr(0,d.length-1))if("break"===function(){n.specificationDefaultDisplay;var t=[];return n.productSkus[i].skus.forEach((function(e){t.push(e.v)})),n.specificationDefaultDisplay={img:n.productSkus[i].resources?n.productSkus[i].resources.img:n.getLists.resources_many[0].img,price_show:[n.productSkus[i].price],inventory_show:n.productSkus[i].inventory,selected:"已选 "+t.join(";"),cost_price:n.productSkus[i].cost_price},n.update||n.$emit("purchasePattern",n.specificationDefaultDisplay),n.cartGood.price=n.productSkus[i].price,n.shoppingAttributes=n.productSkus[i],"break"}())break}}},numberChange:function(data){this.cartGood.number=data},cart:function(t){if(this.shoppingAttributes.id>0||0===this.getLists.good_sku.length){if(!/^\d+\.?\d{0,2}$/.test(this.cartGood.price))return this.$message.error("输入的金额有误"),!1;if(this.$emit("toggleSpec"),this.order){if(this.getLists.good_sku.length>0){var img=this.getLists.resources_many[0].img;this.shoppingAttributes.resources&&(img=this.shoppingAttributes.resources.img);var e={id:this.cartDetails.id?this.cartDetails.id:0,name:this.getLists.name,price:this.cartGood.price,number:this.cartGood.number,good_sku_id:this.shoppingAttributes.id,good_id:this.getLists.id,good:this.getLists,good_sku:this.shoppingAttributes,img:img};this.$emit("setOrder",e)}}else{var r=d.get("TMSHOP-PC-CartList")||[],o=new Map;t&&(r=[]),r.forEach((function(t){o.set(t.good_sku_id,t)}));var h=this.getLists.resources_many[0].img;if(this.getLists.good_sku.length>0)if(this.shoppingAttributes.resources&&(h=this.shoppingAttributes.resources.img),this.update&&this.good_sku.id!==this.shoppingAttributes.id&&o.delete(this.good_sku.id),o.get(this.shoppingAttributes.id)){this.update?o.get(this.shoppingAttributes.id).number=this.cartGood.number:o.get(this.shoppingAttributes.id).number+=this.cartGood.number,o.get(this.shoppingAttributes.id).number>this.specificationDefaultDisplay.inventory_show&&(o.get(this.shoppingAttributes.id).number=this.specificationDefaultDisplay.inventory_show),o.get(this.shoppingAttributes.id).price=this.cartGood.price,o.get(this.shoppingAttributes.id).name=this.getLists.name,o.get(this.shoppingAttributes.id).good_id=this.getLists.id;var l=JSON.parse(JSON.stringify(this.getLists));delete l.details,o.get(this.shoppingAttributes.id).good=l,o.get(this.shoppingAttributes.id).good_sku_id=this.shoppingAttributes.id,o.get(this.shoppingAttributes.id).good_sku=this.shoppingAttributes,o.get(this.shoppingAttributes.id).img=h}else o.set(this.shoppingAttributes.id,{price:this.cartGood.price,number:this.cartGood.number,name:this.getLists.name,good_id:this.getLists.id,good:this.getLists,good_sku_id:this.shoppingAttributes.id,good_sku:this.shoppingAttributes,img:h});else r["good_"+this.getLists.id]?(this.update?r["good_"+this.getLists.id].number=this.cartGood.number:r["good_"+this.getLists.id].number+=this.cartGood.number,r["good_"+this.getLists.id].number>this.getLists.inventory_show&&(r["good_"+this.getLists.id].number=this.getLists.inventory_show),r["good_"+this.getLists.id].price=this.cartGood.price,r["good_"+this.getLists.id].name=this.getLists.name,r["good_"+this.getLists.id].good_id=this.getLists.id,r["good_"+this.getLists.id].good=this.getLists,r["good_"+this.getLists.id].img=h):r["good_"+this.getLists.id]={price:this.cartGood.price,number:this.cartGood.number,name:this.getLists.name,good_id:this.getLists.id,good:this.getLists,img:h};t?d.set("TMSHOP-PC-OrderList",Object(n.a)(o.values())):(Object(c.a)(Object(n.a)(o.values()),(function(t){this.$emit("loadCart")})),d.set("TMSHOP-PC-CartList",Object(n.a)(cartMnnap.values())),$nuxt.$store.commit("setShoppingCartNumber",o.size))}this.initList(),this.update||(t?this.$router.replace("/indent/create"):this.$message({message:"成功加入购物车",type:"success"}))}else this.$message.error("请选择规格")},initList:function(){this.cartGood={number:1,price:""},this.specification=[],this.specificationDefaultDisplay=[],this.SKUResult=[],this.specSelected=[],this.specSelectedIndex=[],this.selectedName=[],this.noSelectedName=[],this.selectedSku=[],this.selectedSkuIndex=[[]],this.productSkus=[],this.shoppingAttributes=[],this.loadData()}}}},586:function(t,e,r){"use strict";r.r(e),r.d(e,"param2Data",(function(){return f}));r(44),r(37),r(43),r(74),r(16),r(75);var n=r(34);r(63);function o(){return parseInt(65536*(1+Math.random()))+""+(new Date).getMilliseconds()}var c=r(532);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function l(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(t[i]);return e}function f(t){if(t&&t.length){var e={},r={},d={};return{productSkus:t.map((function(t){var l=h(h({},t),{},{product_sku_id:t.id,skus:t.product_sku.map((function(t,c){var l="sku"+o(),f="sku"+o();r[t.key]||(r[t.key]=l),d[t.value]||(d[t.value]=f);var m=r[t.key],k=d[t.value];return e[t.key]={value:t.key,id:m,leaf:h(h({},e[t.key]?e[t.key].leaf:{}),{},Object(n.a)({},t.value,{value:t.value,id:k,selected:!1,disabled:!1}))},{k_id:m,k:t.key,v_id:k,v:t.value}}))});return h(h({},l),{},{ids:Object(c.creatIds)(l.skus),data:Object(c.combInArray)(l.skus)})})),specification:l(e).map((function(t){return h(h({},t),{},{leaf:l(t.leaf)})}))}}}}}]);